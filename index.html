<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>AnÃ¡lise de LanÃ§amentos para OrÃ§amento</title>
<link rel="icon" href="imagens/favicon.ico" sizes="any">
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/paginador.css">
</head>
<body>

<header>
  <div class="header-content">
    <div class="logo-container">
      <img src="imagens/logo.png" alt="" class="header-logo" aria-hidden="true">
    </div>
    <h1>AnÃ¡lise de LanÃ§amentos para OrÃ§amento</h1>
  </div>
  <button id="btnGerenciarRegras" class="btn-header">âš™ï¸ Gerenciar Regras</button>
  <button id="btnNovaConciliacao" class="btn-header">âœ¨ Nova AnÃ¡lise</button>
</header>

<main>
  <div id="actionCenter" class="action-center top-fixed hidden">
    <button id="btnComparar">Comparar</button>
   <button id="btnModoFoco" title="Alternar Modo Foco para ComparaÃ§Ã£o">ğŸ¯ Modo Foco</button>
  </div>

  <section class="container">
    <div class="panel">
      <div class="panel-controls">
        <h2 id="bancoTitle" class="panel-title panel-title--banco">Dados do Banco<span id="bancoHiddenCount" class="hidden-count hidden"></span><span class="status-icon">âœ“</span></h2>
        <input type="file" id="fileBanco" accept=".csv,.xlsx,.xls">
        <h3>Ou colar extrato bruto</h3>
        <textarea id="textoBanco" placeholder="Cole aqui o texto copiado do Internet Banking. Ex: fatura do cartÃ£o de crÃ©dito."></textarea>
        
        <div id="painelRefinamento" class="refinement-panel hidden">
          <div class="input-group">
            <label for="filtroDataInicio">1. Mostrar lanÃ§amentos a partir de:</label>
            <input type="date" id="filtroDataInicio">
          </div>
          <div class="input-group">
            <label for="novaDataLancamento">2. Atribuir nova data para todos:</label>
            <input type="date" id="novaDataLancamento">
          </div>
          <button id="btnRefinarDados">Refinar e Aplicar Nova Data</button>
        </div>
        
        <button id="btnProcessarTexto">Processar Texto Bruto</button>
        <button id="btnAplicarRegrasExclusao" class="btn-header" style="background-color: var(--color-red-error); margin-top: 10px;">Limpar com Regras</button>
        <button id="btnExportarPlanilha" class="btn-export">Exportar Tabela Acima (XLSX)</button>
      </div>
      <div class="panel-content">
        <table id="previewBanco"></table>
      </div>
    </div>

    <div class="panel">
      <div class="panel-controls">
        <h2 id="orcamentoTitle" class="panel-title panel-title--orcamento">Dados do OrÃ§amento<span class="status-icon">âœ“</span></h2>
        <input type="file" id="fileOrcamento" accept=".csv,.xlsx,.xls">
      </div>
      <div class="panel-content">
        <table id="previewOrcamento"></table>
      </div>
    </div>
  </section>

  <section id="logPanel" class="discrepancy-section hidden">
    <h2>ğŸ“ Log de AÃ§Ãµes da ConciliaÃ§Ã£o</h2>
    <ul id="logList" class="no-results">Nenhum log gerado.</ul>
  </section>

  <section id="summaryPanel" class="summary-panel hidden">
    <h2 class="panel-title panel-title--resumo">Resumo da ConciliaÃ§Ã£o</h2>
    <div class="summary-metrics">
      <div class="metric-item" data-drop-target="reconciled">
        <span class="metric-value" id="summaryReconciled">0</span>
        <span class="metric-label">âœ… Itens Conciliados</span>
      </div>
      <div class="metric-item" data-drop-target="bank-discrepancy">
        <span class="metric-value" id="summaryBank">0</span>
        <span class="metric-label">âš ï¸ DiscrepÃ¢ncias no Banco</span>
      </div>
      <div class="metric-item" data-drop-target="budget-discrepancy">
        <span class="metric-value" id="summaryBudget">0</span>
        <span class="metric-label">âš ï¸ DiscrepÃ¢ncias no OrÃ§amento</span>
      </div>
    </div>
  </section>
  
  <section id="possibleMatchesPanel" class="discrepancy-section hidden" aria-live="polite" aria-atomic="true">
    <h2>PossÃ­veis CoincidÃªncias (Arraste para uma das caixas acima)</h2>

    <div class="table-filter-container">
        <label for="filterPossibleMatches">ğŸ” Filtrar por descriÃ§Ã£o:</label>
        <input type="text" id="filterPossibleMatches" class="table-filter-input" data-table-id="possibleMatchesTbl" placeholder="Ex: Uber">
    </div>

    <div class="refinement-panel" style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
      <button id="btnAutoMatchHighConfidence" class="btn-export" title="Concilia automaticamente sugestÃµes com confianÃ§a acima de 80%">âœ“ Conciliar SugestÃµes de Alta ConfianÃ§a</button>
      <button id="btnIgnoreAllPossible" class="btn-header">âœ• Ignorar Todas</button>
      <span style="margin-left:auto; font-size:13px; color:var(--color-text-light)">Revise os pares e confirme a aÃ§Ã£o.</span>
    </div>

    <table id="possibleMatchesTbl" aria-label="Tabela de possÃ­veis coincidÃªncias para conciliaÃ§Ã£o manual"></table>
  </section>

  <section class="discrepancy-section">
    <h2>DiscrepÃ¢ncias - Banco</h2>

    <div class="table-filter-container">
        <label for="filterDiscrepBanco">ğŸ” Filtrar por descriÃ§Ã£o:</label>
        <input type="text" id="filterDiscrepBanco" class="table-filter-input" data-table-id="tabelaBanco" placeholder="Ex: Lanche">
    </div>
    
    <button id="btnExportarDiscrepBanco" class="btn-export">Exportar CSV</button>
    <table id="tabelaBanco"></table>
  </section>

  <section class="discrepancy-section">
    <h2>DiscrepÃ¢ncias - OrÃ§amento</h2>

    <div class="table-filter-container">
        <label for="filterDiscrepOrc">ğŸ” Filtrar por descriÃ§Ã£o:</label>
        <input type="text" id="filterDiscrepOrc" class="table-filter-input" data-table-id="tabelaOrcamento" placeholder="Ex: Mercado">
    </div>
    
    <button id="btnExportarDiscrepOrcamento" class="btn-export">Exportar CSV</button>
    <table id="tabelaOrcamento"></table>
  </section>
</main>

<div id="paginador-flutuante" class="hidden">
  <button id="paginador-banco" class="paginador-btn hidden" title="Ir para Dados do Banco">1</button>
  <button id="paginador-orcamento" class="paginador-btn hidden" title="Ir para Dados do OrÃ§amento">2</button>
  <button id="paginador-resumo" class="paginador-btn hidden" title="Ir para Resumo da ConciliaÃ§Ã£o">3</button>
</div>

<div id="modalCopia" class="modal-overlay hidden">
  <div class="modal-content">
    <button class="modal-close" title="Fechar">&times;</button>
    <h2>Ãšltimo LanÃ§amento Processado</h2>
    <p>Confira os dados do Ãºltimo lanÃ§amento encontrado no extrato. VocÃª pode copiÃ¡-los para a Ã¡rea de transferÃªncia.</p>
    <div id="info-copia-container" class="info-versao" style="text-align: center; font-size: 1.1em; padding: 15px;">
    </div>
    <div class="modal-actions" style="justify-content: flex-end; border-bottom: none; padding-bottom: 0;">
        <button id="btnCopiarInfo" class="btn-export">Copiar InformaÃ§Ã£o</button>
    </div>
  </div>
</div>

<footer>
  <p>Ferramenta local - Nenhum dado Ã© enviado para servidores.</p>
</footer>

<div id="regrasModal" class="modal-overlay hidden">
  <div class="modal-content">
    <button class="modal-close" title="Fechar">&times;</button>
    <h2>Regras de ConciliaÃ§Ã£o Salvas</h2>
    <p>A ferramenta aplicarÃ¡ estas regras automaticamente. Exporte suas regras para criar um backup seguro.</p>
    
    <div id="infoVersaoRegras" class="info-versao hidden">
      <span>ğŸ—“ï¸ VersÃ£o das regras ativas:</span>
      <strong id="timestampRegras"></strong>
    </div>

    <div class="modal-actions">
      <button id="btnExportarRegras" class="btn-export">Exportar Regras</button>
      <button id="btnImportarRegras">Importar Regras</button>
      <input type="file" id="importFile" class="hidden" accept=".json">
    </div>

    <ul id="listaRegras"></ul>
    <div id="regrasModalPlaceholder" class="no-results">Nenhuma regra salva.</div>
  </div>
</div>

<div id="createRuleModal" class="modal-overlay hidden">
  <div class="modal-content">
    <button class="modal-close" title="Fechar">&times;</button>
    <h2>Criar Nova Regra de ConciliaÃ§Ã£o</h2>
    <p>Detectamos uma possÃ­vel compra recorrente. Como deseja salvar esta regra?</p>
    
    <div class="rule-options-container">
      <div class="rule-option">
        <input type="radio" id="rule-type-exact" name="rule-type" value="exact" checked>
        <label for="rule-type-exact">
          <strong>Regra Exata (PadrÃ£o)</strong>
          <span>Funciona apenas para esta combinaÃ§Ã£o exata.</span>
        </label>
      </div>
      <div class="rule-option">
        <input type="radio" id="rule-type-smart" name="rule-type" value="smart">
        <label for="rule-type-smart">
          <strong>Regra Inteligente (Recomendado)</strong>
          <span id="smart-rule-preview"></span>
        </label>
      </div>
    </div>
    
    <div class="modal-actions" style="justify-content: flex-end;">
        <button id="btnConfirmarSalvarRegra" class="btn-export">Salvar Regra</button>
    </div>
  </div>
</div>

<button id="btnExitFocusMode" class="hidden" title="Sair do Modo Foco (Esc)">âœ• Sair do Foco</button>

<div id="toastContainer"></div>

<div id="spinnerOverlay" class="spinner-overlay hidden">
  <div class="spinner"></div>
</div>

<script src="js/paginador.js" defer></script>
<script src="js/motor-regras.js" defer></script>
<script src="js/script.js" defer></script>
</body>
</html>
