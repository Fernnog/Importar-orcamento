<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>An√°lise de Lan√ßamentos para Or√ßamento</title>
<link rel="icon" href="imagens/favicon.ico" sizes="any">
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <div class="header-content">
    <div class="logo-container">
      <img src="imagens/logo.png" alt="" class="header-logo" aria-hidden="true">
    </div>
    <h1>An√°lise de Lan√ßamentos para Or√ßamento</h1>
  </div>
  <button id="btnGerenciarRegras" class="btn-header">‚öôÔ∏è Gerenciar Regras</button>
  <button id="btnNovaConciliacao" class="btn-header">‚ú® Nova An√°lise</button>
</header>

<main>
  <section class="container">
    <div class="panel">
      <h2 class="panel-title panel-title--banco">Dados do Banco</h2>
      <input type="file" id="fileBanco" accept=".csv,.xlsx,.xls">
      <h3>Ou colar extrato bruto</h3>
      <textarea id="textoBanco" placeholder="Cole aqui o texto copiado do Internet Banking. Ex: fatura do cart√£o de cr√©dito."></textarea>
      
      <div id="painelRefinamento" class="refinement-panel hidden">
        <div class="input-group">
          <label for="filtroDataInicio">1. Mostrar lan√ßamentos a partir de:</label>
          <input type="date" id="filtroDataInicio">
        </div>
        <div class="input-group">
          <label for="novaDataLancamento">2. Atribuir nova data para todos:</label>
          <input type="date" id="novaDataLancamento">
        </div>
        <button id="btnRefinarDados">Refinar e Aplicar Nova Data</button>
      </div>
      
      <button id="btnProcessarTexto">Processar Texto Bruto</button>
      <button id="btnExportarPlanilha" class="btn-export">Exportar Tabela Acima (XLSX)</button>
      
      <table id="previewBanco"></table>
    </div>

    <div class="panel">
      <h2 class="panel-title panel-title--orcamento">Dados do Or√ßamento</h2>
      <input type="file" id="fileOrcamento" accept=".csv,.xlsx,.xls">
      <table id="previewOrcamento"></table>
    </div>
  </section>

  <div class="action-center">
    <button id="btnComparar">Comparar</button>
  </div>

  <section id="summaryPanel" class="summary-panel hidden">
    <h2>Resumo da Concilia√ß√£o</h2>
    <div class="summary-metrics">
      <div class="metric-item" data-drop-target="reconciled">
        <span class="metric-value" id="summaryReconciled">0</span>
        <span class="metric-label">‚úÖ Itens Conciliados</span>
      </div>
      <div class="metric-item" data-drop-target="bank-discrepancy">
        <span class="metric-value" id="summaryBank">0</span>
        <span class="metric-label">‚ö†Ô∏è Discrep√¢ncias no Banco</span>
      </div>
      <div class="metric-item" data-drop-target="budget-discrepancy">
        <span class="metric-value" id="summaryBudget">0</span>
        <span class="metric-label">‚ö†Ô∏è Discrep√¢ncias no Or√ßamento</span>
      </div>
    </div>
  </section>
  
  <section id="possibleMatchesPanel" class="discrepancy-section hidden" aria-live="polite" aria-atomic="true">
    <h2>Poss√≠veis Coincid√™ncias (Arraste para uma das caixas acima)</h2>

    <div class="refinement-panel" style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
      <button id="btnAutoMatchHighConfidence" class="btn-export" title="Concilia automaticamente sugest√µes com confian√ßa acima de 80%">‚úì Conciliar Sugest√µes de Alta Confian√ßa</button>
      <button id="btnIgnoreAllPossible" class="btn-header">‚úï Ignorar Todas</button>
      <span style="margin-left:auto; font-size:13px; color:var(--color-text-light)">Revise os pares e confirme a a√ß√£o.</span>
    </div>

    <table id="possibleMatchesTbl" aria-label="Tabela de poss√≠veis coincid√™ncias para concilia√ß√£o manual"></table>
  </section>

  <section class="discrepancy-section">
    <h2>Discrep√¢ncias - Banco</h2>
    <button id="btnExportarDiscrepBanco" class="btn-export">Exportar CSV</button>
    <table id="tabelaBanco"></table>
  </section>

  <section class="discrepancy-section">
    <h2>Discrep√¢ncias - Or√ßamento</h2>
    <button id="btnExportarDiscrepOrcamento" class="btn-export">Exportar CSV</button>
    <table id="tabelaOrcamento"></table>
  </section>
</main>

<footer>
  <p>Ferramenta local - Nenhum dado √© enviado para servidores.</p>
</footer>

<!-- Modal de Regras -->
<div id="regrasModal" class="modal-overlay hidden">
  <div class="modal-content">
    <button class="modal-close" title="Fechar">&times;</button>
    <h2>Regras de Concilia√ß√£o Salvas</h2>
    <p>A ferramenta aplicar√° estas regras automaticamente. Exporte suas regras para criar um backup seguro.</p>
    
    <div id="infoVersaoRegras" class="info-versao hidden">
      <span>üóìÔ∏è Vers√£o das regras ativas:</span>
      <strong id="timestampRegras"></strong>
    </div>

    <div class="modal-actions">
      <button id="btnExportarRegras" class="btn-export">Exportar Regras</button>
      <button id="btnImportarRegras">Importar Regras</button>
      <input type="file" id="importFile" class="hidden" accept=".json">
    </div>

    <ul id="listaRegras"></ul>
    <div id="regrasModalPlaceholder" class="no-results">Nenhuma regra salva.</div>
  </div>
</div>

<!-- Modal para criar Regra Inteligente -->
<div id="regraInteligenteModal" class="modal-overlay hidden">
  <div class="modal-content">
    <button class="modal-close" title="Fechar">&times;</button>
    <h2>Criar Regra Inteligente</h2>
    <p>Defina um padr√£o para que a ferramenta reconhe√ßa lan√ßamentos futuros automaticamente, ignorando varia√ß√µes como datas ou n√∫meros de parcela.</p>
    
    <div class="input-group" style="margin-bottom: 20px;">
      <label for="padr√£oBanco" style="font-weight:bold; display:block; margin-bottom:5px;">Se a descri√ß√£o do Banco come√ßar com:</label>
      <input type="text" id="padr√£oBanco" style="width: 100%; padding: 8px;" placeholder="Ex: PAG*Uber">
    </div>
    <div class="input-group">
      <label for="descricaoBaseOrcamento" style="font-weight:bold; display:block; margin-bottom:5px;">Conciliar com a descri√ß√£o do Or√ßamento:</label>
      <input type="text" id="descricaoBaseOrcamento" style="width: 100%; padding: 8px;" placeholder="Ex: Uber">
    </div>
    
    <button id="btnSalvarRegraInteligente" style="margin-top: 20px; width:100%;" class="btn-export">Salvar Regra Inteligente</button>
  </div>
</div>

<!-- Container para as notifica√ß√µes (Toasts) -->
<div id="toastContainer"></div>

<!-- Spinner de Carregamento (Melhoria UX) -->
<div id="spinnerOverlay" class="spinner-overlay hidden">
  <div class="spinner"></div>
</div>

<script src="motor-regras.js" defer></script>
<script src="script.js" defer></script>
</body>
</html>